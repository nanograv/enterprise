dist: trusty
sudo: required

env:
- TOXENV=py35
#- TOXENV=py34
#- TOXENV=py33
#- TOXENV=py27
#- TOXENV=py26
#- TOXENV=pypy
#- TOXENV=flake8
before_install:
    - wget https://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh -O miniconda.sh;
    - chmod +x miniconda.sh
    - bash miniconda.sh -b -p $HOME/miniconda
    - export PATH="$HOME/miniconda/bin:$PATH"
    - conda update --yes conda
    - conda info -a

    - sudo apt-get install gfortran
    - sudo apt-get install libsuitesparse-dev

install:
    - conda create --yes -n test python=$TRAVIS_PYTHON_VERSION
    - source activate test

    - export TEMPO2=$HOME/.local/tempo2
    - export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$TEMPO2/lib
    - mkdir -p $TEMPO2
    - curl -O https://bitbucket.org/psrsoft/tempo2/get/master.tar.gz -z master.tar.gz
    - tar zxvf master.tar.gz
    - cd psrsoft-tempo2-*
    - ./bootstrap
    - ./configure --prefix=$TEMPO2
    -  make && make install
    - cp -Rp T2runtime/* $TEMPO2/.
    - cd ..
    - rm -rf psrsoft-tempo2-*

    - pip install -r requirements_dev.txt
    - pip install -r requirements.txt
    - pip install libstempo --install-option="--with-tempo2=$TEMPO2"
    - python setup.py install

language: python
python: 2.7
#script: tox -e ${TOXENV}
script:
    - which python
    - make test
    - make lint
after_success:
    coveralls
